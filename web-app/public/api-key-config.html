<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”‘ Drahms Vision - API Key Configuration</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .config-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .config-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .config-section {
            background: var(--surface-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .api-category {
            margin-bottom: 30px;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .category-icon {
            font-size: 24px;
        }
        
        .api-item {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .api-item.configured {
            border-color: var(--aurora-green);
            background: rgba(0, 255, 127, 0.1);
        }
        
        .api-item.missing {
            border-color: var(--aurora-red);
            background: rgba(255, 71, 87, 0.1);
        }
        
        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .api-name {
            font-weight: 600;
            color: var(--primary-text);
        }
        
        .api-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .api-status.configured {
            background: var(--aurora-green);
            color: var(--primary-bg);
        }
        
        .api-status.missing {
            background: var(--aurora-red);
            color: var(--primary-bg);
        }
        
        .api-description {
            color: var(--secondary-text);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .api-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .api-detail {
            display: flex;
            flex-direction: column;
        }
        
        .api-detail-label {
            color: var(--secondary-text);
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        .api-detail-value {
            color: var(--primary-text);
            font-size: 14px;
            font-weight: 500;
        }
        
        .api-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .api-input {
            flex: 1;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            color: var(--primary-text);
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .api-input:focus {
            outline: none;
            border-color: var(--aurora-blue);
            box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.2);
        }
        
        .api-input.configured {
            border-color: var(--aurora-green);
        }
        
        .api-buttons {
            display: flex;
            gap: 10px;
        }
        
        .api-button {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            color: var(--primary-text);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .api-button:hover {
            background: var(--hover-bg);
            border-color: var(--aurora-blue);
        }
        
        .api-button.primary {
            background: var(--aurora-blue);
            border-color: var(--aurora-blue);
            color: var(--primary-bg);
        }
        
        .api-button.success {
            background: var(--aurora-green);
            border-color: var(--aurora-green);
            color: var(--primary-bg);
        }
        
        .api-button.danger {
            background: var(--aurora-red);
            border-color: var(--aurora-red);
            color: var(--primary-bg);
        }
        
        .setup-instructions {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .setup-instructions.show {
            display: block;
        }
        
        .setup-steps {
            list-style: none;
            padding: 0;
        }
        
        .setup-steps li {
            padding: 5px 0;
            color: var(--primary-text);
        }
        
        .setup-note {
            background: rgba(0, 191, 255, 0.1);
            border: 1px solid var(--aurora-blue);
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            color: var(--primary-text);
            font-size: 14px;
        }
        
        .summary-panel {
            background: var(--accent-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .summary-stat {
            text-align: center;
        }
        
        .summary-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--aurora-blue);
            margin-bottom: 5px;
        }
        
        .summary-stat-label {
            color: var(--secondary-text);
            font-size: 14px;
        }
        
        .global-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .global-button {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            color: var(--primary-text);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .global-button:hover {
            background: var(--hover-bg);
            border-color: var(--aurora-blue);
            transform: translateY(-2px);
        }
        
        .global-button.primary {
            background: var(--aurora-blue);
            border-color: var(--aurora-blue);
            color: var(--primary-bg);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        .notification.success {
            background: var(--aurora-green);
        }
        
        .notification.error {
            background: var(--aurora-red);
        }
        
        .notification.info {
            background: var(--aurora-blue);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="config-container">
        <div class="config-header">
            <h1><i class="fas fa-key"></i> API Key Configuration</h1>
            <p>Configure your API keys for the Drahms Vision identification system</p>
        </div>
        
        <div class="summary-panel">
            <h2><i class="fas fa-chart-pie"></i> API Status Summary</h2>
            <div class="summary-stats" id="summary-stats">
                <!-- Summary stats will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="config-section">
            <h2><i class="fas fa-cogs"></i> API Configuration</h2>
            
            <!-- Astronomy APIs -->
            <div class="api-category">
                <div class="category-header">
                    <i class="fas fa-star category-icon"></i>
                    <h3>Astronomy APIs</h3>
                </div>
                <div id="astronomy-apis">
                    <!-- Astronomy APIs will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Bird APIs -->
            <div class="api-category">
                <div class="category-header">
                    <i class="fas fa-dove category-icon"></i>
                    <h3>Bird APIs</h3>
                </div>
                <div id="bird-apis">
                    <!-- Bird APIs will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Plant APIs -->
            <div class="api-category">
                <div class="category-header">
                    <i class="fas fa-seedling category-icon"></i>
                    <h3>Plant APIs</h3>
                </div>
                <div id="plant-apis">
                    <!-- Plant APIs will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- General Object APIs -->
            <div class="api-category">
                <div class="category-header">
                    <i class="fas fa-search category-icon"></i>
                    <h3>General Object APIs</h3>
                </div>
                <div id="general-apis">
                    <!-- General APIs will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="global-actions">
            <button class="global-button primary" id="save-all-keys">
                <i class="fas fa-save"></i> Save All Keys
            </button>
            <button class="global-button" id="test-all-keys">
                <i class="fas fa-vial"></i> Test All Keys
            </button>
            <button class="global-button" id="export-keys">
                <i class="fas fa-download"></i> Export Keys
            </button>
            <button class="global-button" id="import-keys">
                <i class="fas fa-upload"></i> Import Keys
            </button>
        </div>
    </div>
    
    <!-- Hidden file input for import -->
    <input type="file" id="import-file" accept=".json" style="display: none;">
    
    <!-- Scripts -->
    <script src="api-keys-config.js"></script>
    <script src="api-key-manager.js"></script>
    <script>
        // API Key Configuration Application
        class APIKeyConfigApp {
            constructor() {
                this.apiKeyManager = new APIKeyManager();
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.loadAPIKeys();
                this.renderAPIKeys();
                this.updateSummary();
                console.log('ðŸ”‘ API Key Configuration App initialized');
            }
            
            loadAPIKeys() {
                // Load API keys from configuration file
                if (window.API_KEYS) {
                    console.log(`ðŸ”‘ Loading ${Object.keys(window.API_KEYS).length} API keys from configuration`);
                    
                    // Filter out placeholder keys
                    const realKeys = {};
                    Object.keys(window.API_KEYS).forEach(key => {
                        if (window.API_KEYS[key] && 
                            !window.API_KEYS[key].includes('your_') && 
                            !window.API_KEYS[key].includes('_here')) {
                            realKeys[key] = window.API_KEYS[key];
                        }
                    });
                    
                    this.apiKeyManager.setAPIKeys(realKeys);
                    console.log(`ðŸ”‘ Loaded ${Object.keys(realKeys).length} real API keys`);
                }
                
                // Also load from localStorage
                const savedKeys = localStorage.getItem('drahms-vision-api-keys');
                if (savedKeys) {
                    try {
                        const keys = JSON.parse(savedKeys);
                        this.apiKeyManager.setAPIKeys(keys);
                        console.log('ðŸ”‘ Loaded API keys from localStorage');
                    } catch (error) {
                        console.error('Error loading API keys from localStorage:', error);
                    }
                }
            }
            
            setupEventListeners() {
                // Global actions
                document.getElementById('save-all-keys').addEventListener('click', () => {
                    this.saveAllKeys();
                });
                
                document.getElementById('test-all-keys').addEventListener('click', () => {
                    this.testAllKeys();
                });
                
                document.getElementById('export-keys').addEventListener('click', () => {
                    this.exportKeys();
                });
                
                document.getElementById('import-keys').addEventListener('click', () => {
                    document.getElementById('import-file').click();
                });
                
                document.getElementById('import-file').addEventListener('change', (e) => {
                    this.importKeys(e.target.files[0]);
                });
            }
            
            
            saveAPIKeys() {
                // Save keys to localStorage
                localStorage.setItem('drahms-vision-api-keys', JSON.stringify(this.apiKeyManager.apiKeys));
                this.showNotification('API keys saved successfully!', 'success');
            }
            
            renderAPIKeys() {
                const keyStatus = this.apiKeyManager.getKeyStatus();
                
                // Render each category
                Object.keys(keyStatus).forEach(category => {
                    const container = document.getElementById(`${category}-apis`);
                    if (container) {
                        container.innerHTML = '';
                        
                        Object.keys(keyStatus[category]).forEach(keyName => {
                            const keyInfo = keyStatus[category][keyName];
                            const apiItem = this.createAPIItem(keyName, keyInfo);
                            container.appendChild(apiItem);
                        });
                    }
                });
            }
            
            createAPIItem(keyName, keyInfo) {
                const item = document.createElement('div');
                item.className = `api-item ${keyInfo.available ? 'configured' : 'missing'}`;
                
                const currentValue = this.apiKeyManager.getAPIKey(keyName) || '';
                
                item.innerHTML = `
                    <div class="api-header">
                        <div class="api-name">${keyInfo.name}</div>
                        <div class="api-status ${keyInfo.available ? 'configured' : 'missing'}">
                            ${keyInfo.available ? 'Configured' : 'Missing'}
                        </div>
                    </div>
                    <div class="api-description">${keyInfo.description}</div>
                    <div class="api-details">
                        <div class="api-detail">
                            <div class="api-detail-label">Rate Limit</div>
                            <div class="api-detail-value">${keyInfo.rateLimit}</div>
                        </div>
                        <div class="api-detail">
                            <div class="api-detail-label">Cost</div>
                            <div class="api-detail-value">${keyInfo.cost}</div>
                        </div>
                        <div class="api-detail">
                            <div class="api-detail-label">Required</div>
                            <div class="api-detail-value">${keyInfo.required ? 'Yes' : 'No'}</div>
                        </div>
                    </div>
                    <div class="api-input-group">
                        <input type="password" class="api-input ${keyInfo.available ? 'configured' : ''}" 
                               id="input-${keyName}" value="${currentValue}" 
                               placeholder="Enter your ${keyInfo.name} API key">
                        <div class="api-buttons">
                            <button class="api-button primary" onclick="apiKeyConfig.saveKey('${keyName}')">
                                <i class="fas fa-save"></i> Save
                            </button>
                            <button class="api-button" onclick="apiKeyConfig.testKey('${keyName}')">
                                <i class="fas fa-vial"></i> Test
                            </button>
                            <button class="api-button" onclick="apiKeyConfig.toggleInstructions('${keyName}')">
                                <i class="fas fa-info-circle"></i> Setup
                            </button>
                        </div>
                    </div>
                    <div class="setup-instructions" id="instructions-${keyName}">
                        <h4>Setup Instructions:</h4>
                        <ol class="setup-steps">
                            ${this.getSetupSteps(keyName).map(step => `<li>${step}</li>`).join('')}
                        </ol>
                        <div class="setup-note">
                            <strong>Note:</strong> ${this.getSetupNote(keyName)}
                        </div>
                    </div>
                `;
                
                return item;
            }
            
            getSetupSteps(keyName) {
                const instructions = this.apiKeyManager.getSetupInstructions();
                return instructions[keyName]?.steps || ['Setup instructions not available'];
            }
            
            getSetupNote(keyName) {
                const instructions = this.apiKeyManager.getSetupInstructions();
                return instructions[keyName]?.note || 'Please check the API documentation for setup instructions';
            }
            
            saveKey(keyName) {
                const input = document.getElementById(`input-${keyName}`);
                const value = input.value.trim();
                
                if (value) {
                    this.apiKeyManager.setAPIKeys({ [keyName]: value });
                    this.renderAPIKeys();
                    this.updateSummary();
                    this.showNotification(`${keyName} saved successfully!`, 'success');
                } else {
                    this.showNotification('Please enter a valid API key', 'error');
                }
            }
            
            async testKey(keyName) {
                try {
                    this.showNotification(`Testing ${keyName}...`, 'info');
                    const result = await this.apiKeyManager.testAPIKey(keyName);
                    this.showNotification(`${keyName} test successful: ${result.message}`, 'success');
                } catch (error) {
                    this.showNotification(`${keyName} test failed: ${error.message}`, 'error');
                }
            }
            
            toggleInstructions(keyName) {
                const instructions = document.getElementById(`instructions-${keyName}`);
                instructions.classList.toggle('show');
            }
            
            saveAllKeys() {
                this.saveAPIKeys();
            }
            
            async testAllKeys() {
                const availableKeys = this.apiKeyManager.getAvailableKeys();
                let tested = 0;
                let passed = 0;
                
                for (const category of Object.keys(availableKeys)) {
                    for (const keyName of Object.keys(availableKeys[category])) {
                        tested++;
                        try {
                            await this.apiKeyManager.testAPIKey(keyName);
                            passed++;
                        } catch (error) {
                            console.error(`Test failed for ${keyName}:`, error);
                        }
                    }
                }
                
                this.showNotification(`API Tests Complete: ${passed}/${tested} passed`, 
                    passed === tested ? 'success' : 'error');
            }
            
            exportKeys() {
                const data = this.apiKeyManager.exportKeys();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'drahms-vision-api-keys.json';
                a.click();
                URL.revokeObjectURL(url);
                this.showNotification('API keys exported successfully!', 'success');
            }
            
            importKeys(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (this.apiKeyManager.importKeys(data)) {
                            this.renderAPIKeys();
                            this.updateSummary();
                            this.showNotification('API keys imported successfully!', 'success');
                        } else {
                            this.showNotification('Invalid API key file format', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error importing API keys: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            }
            
            updateSummary() {
                const summary = this.apiKeyManager.getSummary();
                const summaryStats = document.getElementById('summary-stats');
                
                summaryStats.innerHTML = `
                    <div class="summary-stat">
                        <div class="summary-stat-value">${summary.total}</div>
                        <div class="summary-stat-label">Total APIs</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value">${summary.available}</div>
                        <div class="summary-stat-label">Configured</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value">${summary.missing}</div>
                        <div class="summary-stat-label">Missing</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value">${summary.percentage}%</div>
                        <div class="summary-stat-label">Complete</div>
                    </div>
                `;
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }
        
        // Initialize the application
        let apiKeyConfig;
        document.addEventListener('DOMContentLoaded', () => {
            apiKeyConfig = new APIKeyConfigApp();
        });
    </script>
</body>
</html>
